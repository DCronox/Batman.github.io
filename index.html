<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="TerraData: Monitorea y optimiza las condiciones de cultivo para tus plantas en tiempo real." />
  <meta name="keywords" content="cultivo, monitoreo, humedad, temperatura, plantas, agricultura, smart farm, datos en tiempo real, tomate, cilantro, papa, frijol, pepino" />
  <meta name="author" content="TerraData Team" />

  <meta property="og:title" content="TerraData - Monitorea tu Cultivo" />
  <meta property="og:description" content="ObtÃ©n datos en tiempo real sobre humedad y temperatura para optimizar el crecimiento de tus plantas." />
  <meta property="og:image" content="https://example.com/terradata-share-image.jpg" />
  <meta property="og:url" content="https://example.com" />
  <meta property="og:type" content="website" />

  <title>TerraData - Monitorea tu Cultivo</title>

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%25' y='50%25' style='dominant-baseline:central;text-anchor:middle;font-size:80px;'%3E%F0%9F%8C%B1%3C/text%3E%3C/svg%3E" type="image/svg+xml" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="background-particles">
    <div class="particle particle1"></div>
    <div class="particle particle2"></div>
    <div class="particle particle3"></div>
    <div class="particle particle4"></div>
    <div class="particle particle5"></div>
    <div class="particle particle6"></div>
    <div class="leaf leaf1"></div>
    <div class="leaf leaf2"></div>
    <div class="leaf leaf3"></div>
    <div class="leaf leaf4"></div>
    <div class="leaf leaf5"></div>
    <div class="leaf leaf6"></div>
  </div>

  <div class="fixed-actions">
    <button class="optimum-params-btn" aria-expanded="false" aria-controls="optimum-params-section">
      ğŸŒ± ParÃ¡metros Ã“ptimos
    </button>
    <button class="optimum-params-btn" aria-label="Cambiar tema">
      ğŸŒ“ Tema
    </button>
    <button class="optimum-params-btn" aria-label="Forzar lectura">
      âš¡ Forzar Lectura
    </button>

    <div id="evaluacion-text" style="width:100%; text-align:center; margin-top:0.5rem; display:none;">Esperando datos...</div>

    <button id="reload-btn" class="optimum-params-btn" style="margin-top:0.4rem;">ğŸ”„ Recargar</button>

    <!-- Mover Ãºltima actualizaciÃ³n debajo del botÃ³n recargar -->
    <div id="last-update" class="hora-ultima-lectura" style="font-size:0.95rem; margin-top:0.6rem;">Ãšltima actualizaciÃ³n: --</div>
  </div>

  <header role="banner">
    <div class="logo-title">
      <h1>TerraData</h1>
    </div>
    <p class="subtitle">Monitorea tu cultivo en tiempo real</p>
  </header>

  <main role="main">
    <section class="cards" aria-labelledby="sensor-data-heading">
      <h2 id="sensor-data-heading" class="sr-only">Datos de Sensores</h2>

      <!-- Humedad del Suelo -->
      <div class="card-toggle">
        <button class="sensor-btn" data-card="card-humedad" aria-expanded="false" aria-controls="card-humedad">
          Humedad Suelo
        </button>
        <div class="card-wrapper" id="card-humedad" role="region" aria-live="polite">
          <div class="card-summary">
            <div class="sensor-display">
              <div class="icon">ğŸ’§</div>
              <div>
                <div class="label">Humedad Suelo</div>
                <div class="value" id="humedad-value">--</div>
                <div class="small" id="humedad-summary">--</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="visualization">
              <div class="container-wrapper">
                <div class="container small">
                  <div id="water" class="water" style="height:0%"></div>
                </div>
                <div class="panel-value" id="humedad-panel-value">--%</div>
              </div>
            </div>

            <div class="details">
              <div>Huerta 1: <span id="humedad-huerta1-value">--</span>%</div>
              <div>Huerta 2: <span id="humedad-huerta2-value">--</span>%</div>
              <div id="evaluacion-huerta1-card" class="small"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Temperatura -->
      <div class="card-toggle">
        <button class="sensor-btn" data-card="card-temp" aria-expanded="false" aria-controls="card-temp">
          Temperatura
        </button>
        <div class="card-wrapper" id="card-temp" role="region" aria-live="polite">
          <div class="card-summary">
            <div class="sensor-display">
              <div class="icon">ğŸŒ¡ï¸</div>
              <div>
                <div class="label">Temperatura</div>
                <div class="value" id="temp-value">--</div>
                <div class="small" id="temp-summary">--</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="thermometer-container">
              <div class="thermometer-wrapper">
                <div class="thermometer" role="img" aria-label="TermÃ³metro">
                  <!-- tubo del termÃ³metro -->
                  <div class="stem">
                    <div id="thermometer-fluid" class="fluid" style="height:0%"></div>
                  </div>
                  <!-- bombilla -->
                  <div class="bulb"></div>
                </div>
                <!-- Valor grande sobre el termÃ³metro -->
                <div class="panel-value panel-value-temp" id="temp-panel-value">-- Â°C</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Humedad Ambiente -->
      <div class="card-toggle">
        <button class="sensor-btn" data-card="card-amb" aria-expanded="false" aria-controls="card-amb">
          Humedad Ambiente
        </button>
        <div class="card-wrapper" id="card-amb" role="region" aria-live="polite">
          <div class="card-summary">
            <div class="sensor-display">
              <div class="icon">â˜ï¸</div>
              <div>
                <div class="label">Humedad Ambiente</div>
                <div class="value" id="humedad-ambiente-value">--</div>
                <div class="small" id="humedad-amb-summary">--</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="visualization">
              <div class="container-wrapper">
                <!-- nube variante 'alt' (mÃ¡s volumÃ©trica) -->
                <div class="cloud alt" aria-hidden="false" title="Humedad ambiente">
                  <div id="water-ambiente" class="cloud-water" style="height:0%"></div>
                </div>
                <div class="panel-value" id="humedad-amb-panel-value">--%</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
<!-- BotÃ³n redondo en esquina inferior izquierda -->
<button id="toggle-history-btn" style="
  position: fixed;
  bottom: 1.2rem;
  left: 1.2rem;
  width: 3.2rem;
  height: 3.2rem;
  font-size: 1.4rem;
  background-color: #00796b;
  color: white;
  border: none;
  border-radius: 50%;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  cursor: pointer;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
">
  ğŸ“ˆ
</button>

<!-- Fondo oscuro detrÃ¡s del modal -->
<div id="modal-overlay" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.4);
  z-index: 1500;
"></div>

<!-- Panel emergente tipo modal -->
<div id="history-panel" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 12px 30px rgba(0,0,0,0.2);
  padding: 1.2rem;
  z-index: 2000;
">

  <!-- TÃ­tulo del modal -->
  <h2 style="
    text-align: center;
    font-size: 1.6rem;
    font-weight: 700;
    color: #00796b;
    margin-bottom: 1rem;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 0.5rem;
  ">
    Historial de Humedad y Temperatura
  </h2>

  <!-- Estado de lluvia en MedellÃ­n -->
  <div id="rain-status" style="width:100%; display:flex; justify-content:center; margin-top:0.6rem; gap:0.6rem; align-items:center;">
    <div id="rain-badge" aria-live="polite" style="padding:0.45rem 0.8rem; border-radius:999px; background:rgba(255,255,255,0.9); color:#00796b; box-shadow:0 6px 18px rgba(0,0,0,0.06); font-weight:700;">
      Estado lluvia: --
    </div>
    <button id="export-hourly-btn" class="optimum-params-btn" style="padding:0.5rem 0.9rem; font-size:0.95rem;">
      ğŸ“¥ Exportar Historial
    </button>
  </div>

  <!-- Historial horario (carrusel horizontal) -->
  <section id="hourly-history" style="width:100%; margin-top:1.2rem;">
    <h3 class="sr-only">Historial horario</h3>
    <div id="history-track" class="history-track" aria-live="polite" style="display:flex; gap:0.8rem; padding:0.8rem; overflow-x:auto;">
      <!-- AquÃ­ puedes insertar tarjetas de historial dinÃ¡micamente -->
    </div>
  </section>

  <!-- Historial grÃ¡fico -->
  <section class="history-section">
    <canvas id="historyChart" width="600" height="260" style="max-width:100%;"></canvas>
  </section>

  <!-- BotÃ³n para cerrar el modal -->
  <div style="text-align:right; margin-top:1rem;">
    <button id="close-history-btn" style="
      padding: 0.5rem 1rem;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    ">Cerrar</button>
  </div>
</div>

<!-- JavaScript para mostrar/ocultar el modal -->
<script>
  const toggleBtn = document.getElementById('toggle-history-btn');
  const historyPanel = document.getElementById('history-panel');
  const modalOverlay = document.getElementById('modal-overlay');
  const closeBtn = document.getElementById('close-history-btn');

  toggleBtn.addEventListener('click', () => {
    historyPanel.style.display = 'block';
    modalOverlay.style.display = 'block';
  });

  closeBtn.addEventListener('click', () => {
    historyPanel.style.display = 'none';
    modalOverlay.style.display = 'none';
  });

  modalOverlay.addEventListener('click', () => {
    historyPanel.style.display = 'none';
    modalOverlay.style.display = 'none';
  });
</script>

    <!-- Justo antes de </main> 
    <section class="history-section">
      <h2 class="history-title">Historial de Humedad y Temperatura</h2>
      <canvas id="historyChart" width="600" height="260" style="max-width:100%;"></canvas>
    </section>
  </main>-->

  <!-- Modal de ParÃ¡metros Ã“ptimos -->
  <div class="optimum-params-section" id="optimum-params-section" role="dialog" aria-modal="true" aria-labelledby="optimum-params-heading" aria-hidden="true">
    <div class="optimum-modal">
      <h2 id="optimum-params-heading">ğŸŒ± ParÃ¡metros Ã“ptimos para Plantas</h2>
      <div class="plant-list-scrollable">
        <div class="plant-list">
          <div class="plant-item">
            <h3>ğŸ… Tomate</h3>
            <p>Humedad Ã“ptima: 60-80%</p>
            <p>Temperatura Ã“ptima: 20-25Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸŒ¿ Cilantro</h3>
            <p>Humedad Ã“ptima: 40-50%</p>
            <p>Temperatura Ã“ptima: 10-30Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸ¥” Papa</h3>
            <p>Humedad Ã“ptima: 90-95%</p>
            <p>Temperatura Ã“ptima: 17-25Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸŒ± Frijol</h3>
            <p>Humedad Ã“ptima: 60-70%</p>
            <p>Temperatura Ã“ptima: 10-21Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸ¥’ Pepino</h3>
            <p>Humedad Ã“ptima: 65-85%</p>
            <p>Temperatura Ã“ptima: 20-28Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸŒ¾ Trigo</h3>
            <p>Humedad Ã“ptima: 40-60%</p>
            <p>Temperatura Ã“ptima: 15-25Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸŒ½ MaÃ­z</h3>
            <p>Humedad Ã“ptima: 60-75%</p>
            <p>Temperatura Ã“ptima: 20-30Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸ“ Fresa</h3>
            <p>Humedad Ã“ptima: 70-80%</p>
            <p>Temperatura Ã“ptima: 18-22Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸŒ¶ï¸ Pimiento</h3>
            <p>Humedad Ã“ptima: 60-70%</p>
            <p>Temperatura Ã“ptima: 22-28Â°C</p>
          </div>
          <div class="plant-item">
            <h3>ğŸ¥• Zanahoria</h3>
            <p>Humedad Ã“ptima: 60-80%</p>
            <p>Temperatura Ã“ptima: 15-25Â°C</p>
          </div>
        </div>
      </div>
      <button class="back-btn" onclick="hideOptimumParams()">Volver</button>
    </div>
  </div>

  <!-- Widget flotante de recomendaciones mejorado -->
  <div id="reco-widget" class="reco-widget">
    <span class="reco-label">Â¿QuÃ© plantar ahora?</span>
    <button id="reco-toggle" class="reco-toggle" aria-label="Mostrar recomendaciones">ğŸŒ±</button>
    <div id="reco-panel" class="reco-panel">
      <div class="reco-header">
        <span>ğŸŒ± Â¿QuÃ© plantar ahora?</span>
        <button class="reco-close" aria-label="Cerrar recomendaciones">âœ–</button>
      </div>
      <div class="reco-content">
        <div class="reco-item">
          <div class="reco-item-title" style="font-weight:700; margin-bottom:6px;">Huerta 1</div>
          <div id="evaluacion-huerta1-widget">--</div>
        </div>
        <div class="reco-item" style="margin-top:8px;">
          <div class="reco-item-title" style="font-weight:700; margin-bottom:6px;">Huerta 2</div>
          <div id="evaluacion-huerta2-widget">--</div>
        </div>
      </div>
    </div>
  </div>

  <div id="clima-decor" class="clima-decor"></div>

  <footer role="contentinfo">
    <span>ğŸŒ± TerraData Â© 2025 | Hecho con <span class="footer-heart" aria-label="amor">â¤</span> para agricultores inteligentes</span>
  </footer>

  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>